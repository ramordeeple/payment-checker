# üè¶ Payment Checker Service

### –°–µ—Ä–≤–∏—Å –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–ª–∞—Ç–µ–∂–µ–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–æ–∫-—Å–µ—Ä–≤–∏—Å–∞ –¶–ë.

* –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–ª–∞—Ç–µ–∂–∏ –≤ —Ä—É–±–ª—è—Ö –∏ –∑–∞—Ä—É–±–µ–∂–Ω—ã—Ö –≤–∞–ª—é—Ç–∞—Ö.
* –í–∞–ª—é—Ç–∞ –∏ –∫—É—Ä—Å –±–µ—Ä—É—Ç—Å—è –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑—ã —á–µ—Ä–µ–∑ –º–æ–∫ `/cbr`.
* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ HTTP –∏ gRPC –¥–ª—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è.
* Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

---

## ‚öôÔ∏è –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç       | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏           |
|-----------------|----------------------|
| Backend         | Go, net/http, gRPC   |
| Database        | PostgreSQL           |
| API Docs        | Swagger              |
| Dev Environment | Docker Compose       |
| Testing         | Go tests, .http file |
| Build           | Go modules, Makefile |

---

## üß± –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
cmd/payment-checker ‚Äî —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (main.go)
internal/
  adapter/          ‚Äî HTTP/gRPC handlers
  domain/           ‚Äî DDD —è–¥—Ä–æ
  usecase/          ‚Äî –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞, Policy, Converter, —Ç–µ—Å—Ç—ã
  repository/       ‚Äî —Ä–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π 
  port/             ‚Äî –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã 
docs/               ‚Äî —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1Ô∏è‚É£ –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

* Go 1.21+
* Docker Desktop  (–¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö)

---

### 2Ô∏è‚É£ –ü–æ–¥–Ω—è—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

–ü—Ä–∏–º–µ—Ä `docker-compose.yml`:

```yaml
services:
  db:
    image: postgres:latest
    command: ["postgres", "-c", "port=5433"]
    environment:
      POSTGRES_DB: payment_db
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: 123
    ports:
      - "5433:5433"
    volumes:
      - ./migrations:/docker-entrypoint-initdb.d
```

–í –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```bash
docker compose up -d
```

–ë—É–¥—É—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω—ã —É–∫–∞–∑–∞–Ω–Ω—ã–µ –Ω–∏–∂–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–Ω–∞—á–µ–Ω–∏–π:

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ   |
|----------|------------|
| Host     | localhost  |
| Port     | 5433       |
| Database | payment_db |
| Username | postgres   |
| Password | 123        |

–õ–∏–±–æ –∂–µ –ø—Ä–∞–≤–æ–π –∫–Ω–æ–ø–∫–æ–π –º—ã—à–∏ –ø–æ `docker-compose.yml` –∏ `Run 'payment_db'`, –µ—Å–ª–∏ –≤ **GoLand**.

> ‚ö†Ô∏è –ü–æ—Ä—Ç 5433 –≤—ã–±—Ä–∞–Ω, —á—Ç–æ–±—ã –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å –ª–æ–∫–∞–ª—å–Ω—ã–º 5432.


---

### 3Ô∏è‚É£ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–£–∫–∞–∑–∞–Ω –≤ `main.go` —Ç–æ–ª—å–∫–æ –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:

```
DB_URL=postgres://postgres:123@localhost:5433/payment_db?sslmode=disable
```

---

### 4Ô∏è‚É£ –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–ß–µ—Ä–µ–∑ Makefile:

```bash
make run
```

–∏–ª–∏ –Ω–∞–ø—Ä—è–º—É—é:

```bash
cd cmd/payment-checker
go run main.go
```

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞:

* HTTP API: `http://localhost:8080`
* gRPC —Å–µ—Ä–≤–µ—Ä: `localhost:9090`
* Swagger UI: `http://localhost:8080/swagger/index.html`

---

## üåê API

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 

```http
POST http://localhost:8080/validate
Content-Type: application/json

{
  "provider": "provider",
  "amount": 751234,
  "currency": "RUB",
  "date": "2025-10-10"
}
```

 –ü–æ–ª—É—á–µ–Ω–∏–µ –∫—É—Ä—Å–∞ –≤–∞–ª—é—Ç—ã (–º–æ–∫ –¶–ë)

```http
GET http://localhost:8080/cbr?currency=USD&date=2025-10-21
Accept: application/xml
```

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:**

```xml
<Valute>
<CharCode>USD</CharCode>
<Nominal>1</Nominal>
<Value>751234</Value>
</Valute>
```

> ‚ö†Ô∏è –ó–¥–µ—Å—å `Value` –∏–º–µ–µ—Ç —Ç–∏–ø `int64` –≤–æ –∏–∑–±–µ–∂–∞–Ω–∏—è –æ—à–∏–±–æ–∫ —Å –ø–ª–∞–≤–∞—é—â–µ–π —Ç–æ—á–∫–æ–π. –ü–æ —Å—É—Ç–∏ **USD** –ø–æ–ª—É—á–µ–Ω –≤ —Ü–µ–Ω—Ç–∞—Ö.
---

## üì° gRPC

### –ó–∞—á–µ–º gRPC

* –ü–æ–∑–≤–æ–ª—è–µ—Ç –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º –æ–±—â–∞—Ç—å—Å—è –Ω–∞–ø—Ä—è–º—É—é —Å **proto buffers**, —á—Ç–æ –≤–∞–∂–Ω–æ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö e2e —Ç–µ—Å—Ç–æ–≤.

* –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç —á–µ—Ä–µ–∑ **.proto**.

* –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤.

–ü—Ä–∏–º–µ—Ä **gRPC** —Å–µ—Ä–≤–∏—Å–∞:

```proto
service PaymentChecker {
  rpc Validate(ValidatePaymentRequest) returns (ValidatePaymentResponse);
}
```

---

## ü™¢ –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–∫-—Å–µ—Ä–≤–∏—Å–∞

* `/cbr` ‚Äî –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ –±–∞–∑–µ `rates` –∏ `currencies`.
* **–ì–∏–±–∫–æ—Å—Ç—å:** –¥–∞–Ω–Ω—ã–µ –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –≤ –±–∞–∑–µ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞.
* **–í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç—å:** –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.
* **–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å:** —Ç–µ—Å—Ç—ã –Ω–µ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö API –∏ —Å–µ—Ç–∏.

### –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:

* –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –Ω–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–æ–∫–∞–º–∏.
* –ï–¥–∏–Ω—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π —Å—Ç–µ–Ω–¥ –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–æ—Ç–Ω–∏ e2e —Ç–µ—Å—Ç–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.
* –î–µ—Ç–µ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –±–∞–∑—ã –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∏ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å.

–ú–æ–∫-—Å–µ—Ä–≤–∏—Å `/cbr` –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑–µ (`currencies` –∏ `rates`) –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç
–∫—É—Ä—Å –≤–∞–ª—é—Ç—ã –Ω–∞ –∑–∞–¥–∞–Ω–Ω—É—é –¥–∞—Ç—É –≤ `JSON` –∏–ª–∏ `xml`.

### –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:

* –ì–∏–±–∫–æ—Å—Ç—å ‚Äî –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –±–∞–∑–µ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞.

* –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç—å ‚Äî –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –≤—Å–µ–≥–¥–∞ –¥–∞—ë—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

* –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å ‚Äî –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤–Ω–µ—à–Ω–µ–≥–æ API –∏–ª–∏ —Å–µ—Ç–∏.

* –í –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ —Å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–º–∏ e2e —Ç–µ—Å—Ç–∞–º–∏ –Ω–µ–ª—å–∑—è —É–ø—Ä–∞–≤–ª—è—Ç—å –º–æ–∫–∞–º–∏ —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–ª–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∏. 
–î–∞–Ω–Ω—ã–µ –∏–∑ –±–∞–∑—ã –ø–æ–∑–≤–æ–ª—è—é—Ç —Ç–µ—Å—Ç–∞–º –±—ã—Ç—å –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–º–∏.

---

## üìÑ Swagger

### –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –º–æ–∂–Ω–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é:
* Swagger UI: `http://localhost:8080/swagger/index.html`
* JSON: `http://localhost:8080/swagger/doc.json`

---

## ‚úÖ –ò—Ç–æ–≥

* #### –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–∞—è —Ç–µ—Å—Ç–æ–≤–∞—è —Å—Ä–µ–¥–∞.
* #### –ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ –ª–æ–∫–∞–ª—å–Ω—É—é –ë–î.
* #### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å HTTP/gRPC.
* #### Swagger UI.
